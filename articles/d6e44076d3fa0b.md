---
title: "【Github Copilot】読み取り専用カスタムエージェントの作成"
emoji: "📖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [ai,githubcopilot,vscode]
published: true
---

## はじめに
この記事ではGithub Copilotのカスタムエージェント機能を使用し、読み取り専用のエージェントを作成しつつ、カスタムエージェントが結構使い所ありそうだなというのを伝えようと思います。
Github CopilotなどのAIコーディング系のツールは、Skillsやサブエージェントなど含めてやれることが多くて定義するのも難しい（面倒くさい）と考える人もいると思いますが、カスタムエージェントという機能をできる限り簡単に活用することを今回は考えます。

## 今回の読み取り専用エージェントを作るきっかけ
github copilotには以下のようなモードを切り替えて質問や指示を行うことが可能です。
- Ask
- Edit
- Agent
- Plan

詳細は以下の記事がとても有益でしたので、ご確認ください。
https://zenn.dev/openjny/articles/5487004a195051

自分の中でモードの使い分けとしては以下のような感じでした。
- Ask：使わない
- Edit：使わない
- Agent：基本これ
- Plan：難しいタスクなど計画を立てさせたい場合は使うこともある

Askモードでは、コード編集などを行わずに質問に答えてくれるため、コードの説明などをさせたい場合に最適なモードのように思えます。
ただ、Askモードでは選択した以外の部分などプロジェクトのコードを網羅的に調べてくれなかったり、MCPを使って調べてくれないので、どうしてもAgentモードで聞いた方が回答精度が高いと思っています。
逆にAgentモードについては、万能なので助かっている一方、説明だけをしてほしいのに、勝手にコードまで修正したりして、少し面倒な場合があります。
![](/images/d6e44076d3fa0b/1.png =500x)
例えばこの画像のような指示で、まずは原因を知りたいだけなのに、勝手にコード修正されたという経験がある人は多いのではないでしょうか？
Agentモードで勝手に修正させない方法は、例えば以下があると思います。
- 指示でコード修正は不要なことを記載する
- Agentのツール選択で、コード編集系のチェックを外した上で、質問を投げる

ただ、コード解説など、よくやる質問に対して、毎回コード修正しない旨を書いたり、ツールを都度選択するのは結構面倒です。
そこで、読み取り専用のカスタムエージェントを作ったら便利なのではと考えました。


## Github Copilotのカスタムエージェントとは
あらかじめ定義されたシステムメッセージとツールセットを組み合わせて、特定のタスクに最適化されたエージェントを作成する仕組みです
詳しいことは以下のドキュメントを読んでもらう方がいいと思いますが、この記事でも作り方は軽く紹介していくので、一旦この記事を読んでイメージを掴んでもらえれば良いかなと思います。
https://docs.github.com/ja/copilot/concepts/agents/coding-agent/about-custom-agents

コンテキストウィンドウ（AIに与える指示）の分量が多くなるとAIの回答精度が下がるので、質問時にAIが使えるMCPなどを増やしすぎない方がいいという話がありますが、カスタムエージェントでは使えるMCPを前もって制限することが可能です。
特定のMCPを使って欲しい際にもいちいちツール選択したり、「〜のmcpを使って」のような指示文を書かなくてもよくなるので、いつもよく使うMCPなどはカスタムエージェントにするのも良いと思います。

## カスタムエージェントの作り方
参考
https://docs.github.com/ja/copilot/how-tos/use-copilot-agents/coding-agent/create-custom-agents
:::message
2025年12月31日時点での操作方法なので、アップデートによって見た目など色々変わると思います。
:::
### カスタムエージェントの作成
質問入力欄からカスタムエージェントの構成をクリック
※この入口はカスタムエージェントを作りやすくするために存在するだけで、この後の処理で作られるディレクトリやファイルを自分で作成しても動作します。
![](/images/d6e44076d3fa0b/2.png =500x)
新しいカスタムエージェントを作成
![](/images/d6e44076d3fa0b/3.png =500x)
プロジェクト内のファイルに作成する場合は.github/agentsを選択（今回はこれで行きます）
→どのプロジェクトでも共通して使えるユーザー側の設定に追加したい場合はユーザーデータを選択しても良い
![](/images/d6e44076d3fa0b/4.png =500x)
カスタムエージェントの名前を書いて、Enter
![](/images/d6e44076d3fa0b/5.png =500x)
.github/agentsディレクトリにreadonly.agent.mdというファイルが作成され、このファイルを修正することで、カスタムエージェントとして使える
![](/images/d6e44076d3fa0b/6.png)

### カスタムエージェントの編集
今回は読み取り専用のエージェントを作りたかったので、以下のコードのように修正しました。
```
---
description: 'コードベースの調査や分析を行う読み取り専用エージェント'
name: 'Readonly'
tools:
  ['vscode/extensions', 'read', 'search', 'web', 'context7/*', 'todo']
argument-hint: '調査したい内容を質問してください'
---

# Readonly Agent
このエージェントは、コードベースやプロジェクトに関する様々な質問に答えるための読み取り専用エージェントです。
ユーザーの質問に基づいて、コードの調査、分析、情報提供を行います。
```
YAMLフロントマター部分に設定値などを書いて、その下にプロンプトを書く感じです（最近よく見かけるやつですね）。
descriptionやnameの部分は自分がわかりやすければOKです。
あとは、汎用的に質問に答えられるけど、編集はできないっていう簡単な役割をプロンプトとして書いてます。

今回一番大事なのはtoolの部分に何を書いて、使えるツールの制限をするかです。ここには、VScodeがデフォルトで用意してくれているツールや、拡張機能で使えるツール、MCPによって追加されたツールが使用できます。なので、今回は自分がよく使うcontext7もmcpの例として追加してますが、この辺りは各自自由に設定してもらえれば大丈夫です。

とはいえ、mcpのツール名とかどうやって調べればいいかわからないor面倒ってなると思います。
そういう場合に、VScode画面でtoolsの上に「ツールの構成」があり、それをクリックすると
![](/images/d6e44076d3fa0b/7.png =500x)
Agentモードのツールの選択同様、ツール一覧から選択ができ、ここで選択してOKを押すと設定がmdファイルの方に反映されます（便利！）。
下の画像のように、ファイルを編集するedit系のツールを取り除くことによりファイル編集をさせないようにしています。
![](/images/d6e44076d3fa0b/8.png =500x)
:::message
なんとなく読み取りに必要そうなツールを選んだつもりですが、不要なものも入っているかもなので、そこは各自不要なツールを排除して、コンテキストウィンドウの削減をしてもらえればと思います
:::
### カスタムエージェントの使い方
質問入力欄にモード選択でReadonlyが選べるので、あとはこれを選択して質問を投げるだけです。
![](/images/d6e44076d3fa0b/9.png =500x)
自分がReadonlyエージェントを使いたいと思った時に、簡単に切り替えできるのが便利だなと思っています。

## まとめ
読み取り専用のカスタムエージェントを作ることによって、精度高くコード編集されずにAIに回答してもらうことが可能になりました。
もちろんカスタムエージェントもプロンプトやツールなどを工夫して、より難しいタスクをこなすことも可能と思いますが、今回のような簡単な例でも活用できそうな場面は多くありそうだなと感じました。