---
title: "ï¼ˆä»Šã•ã‚‰ï¼‰GPTç³»ã®ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ°—ã«ãªã£ãŸã¨ã“ã‚ã‚’èª¿ã¹ã¦ã¿ã‚‹"
emoji: "ğŸƒ"
type: "tech"
topics:
  - "ai"
  - "gpt"
  - "openai"
  - "ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«"
  - "gpt4omini"
published: true
published_at: "2024-08-31 22:28"
---

:::message
ã“ã®è¨˜äº‹ã¯2024å¹´8æœˆ30æ—¥ã®åŸ·ç­†æ™‚ç‚¹ã§ã®æƒ…å ±ã¨ãªã‚Šã¾ã™ã€‚
:::

## åˆã‚ã«
GPTç³»ã®ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ¢ãƒ‡ãƒ«ï¼ˆgpt-4oã‚„gpt-4o-miniãªã©ï¼‰ãŒä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã‹ã‚‰ã€ã‚‚ã†ãã‚Œãªã‚Šã«çµŒã¡ã¾ã—ãŸãŒã€APIã§ä»Šã¾ã§ä½¿ç”¨ã—ã¦ã„ãªã‹ã£ãŸã®ã§ã€æ°—ã«ãªã£ã¦ã„ãŸã“ã¨ã‚’èª¿ã¹ã¦ã¿ã‚ˆã†ã¨ã„ã†è¨˜äº‹ã§ã™ã€‚åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯OpenAIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ã„ã‚ã‚“ãªæ–¹ãŒè¨˜äº‹ã‚’å‡ºã—ã¦ã„ã‚‹ã®ã§ã€ã“ã®è¨˜äº‹ã«æ›¸ãå¿…è¦ã‚‚ãªã„ã®ã§ã™ãŒã€ä¸€éƒ¨åŸºæœ¬çš„ãªä½¿ã„æ–¹ã‚‚è¨˜è¼‰ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## ãã‚‚ãã‚‚ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ¢ãƒ‡ãƒ«ã£ã¦ä½•ï¼Ÿ
åˆæœŸã§ã¯ã€ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’å›ç­”ã—ã¦ãã‚Œã‚‹ã‚ˆã†ãªãƒ¢ãƒ‡ãƒ«ãŒå¤šã‹ã£ãŸã§ã™ãŒã€æœ€è¿‘ã§ã¯ç”»åƒãƒ»å‹•ç”»ãƒ»éŸ³å£°ãªã©ã„ã‚ã‚“ãªæƒ…å ±ã‚’åŸºã«å›ç­”ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¦ãŠã‚Šã€è¤‡æ•°ã®ç•°ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ã‚’å…¥åŠ›ã¨ã—ã¦ä½¿ãˆã‚‹ã‚‚ã®ã‚’ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã¨è¨€ã„ã¾ã™ã€‚gpt-4oãªã©ã®OpenAIã®ãƒ¢ãƒ‡ãƒ«ã¯ã¾ã ç”»åƒã®å…¥åŠ›ã—ã‹ã§ããšã€éŸ³å£°ã‚„å‹•ç”»ã¯å…¥åŠ›ã¨ã—ã¦ã¯ã€ä½¿ãˆã¾ã›ã‚“ãŒã€ä»Šå¾Œã¯å…¥åŠ›ã«éŸ³å£°ã‚„å‹•ç”»ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã‚Šã€å‡ºåŠ›ï¼ˆå›ç­”ï¼‰ã‚‚ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã§ãªãã€éŸ³å£°ãªã©ã„ã‚ã‚“ãªå‡ºåŠ›å½¢å¼ãŒå¯èƒ½ã«ãªã£ã¦ã„ãã§ã—ã‚‡ã†ã€‚
ã“ã“ã‚‰è¾ºã¯ä»¥ä¸‹è¨˜äº‹ã®ã‚ˆã†ã«è‰²ã€…æƒ…å ±ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€æ°—ã«ãªã‚‹æ–¹ã¯ãƒãƒƒãƒˆã®è¨˜äº‹ãªã©ç¢ºèªã—ã¦ãã ã•ã„ã€‚
https://www.softbank.jp/biz/solutions/generative-ai/ai-glossary/multimodal-ai/

## ä»Šå›ç¢ºèªã™ã‚‹ã“ã¨
ä»Šå›ã¯gpt-4o-miniã‚’ä½¿ç”¨ã—ã¦ç”»åƒå…¥åŠ›ã«é–¢ã™ã‚‹èª¿æŸ»ã‚’ã—ã¦ã„ãã¾ã™ã€‚gpt-4oã§ã¯ãªãã€gpt-4o-miniã‚’ä½¿ã†ã®ã¯å˜ã«å®‰ã„ã‹ã‚‰ã§ã™ã€‚gpt-4oã®æ–¹ãŒç²¾åº¦ã¯é«˜ã„ã§ã™ã—ã€webç‰ˆã®chatGPTã§gpt-4oã®ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è©¦ã—ã¦ã€ã“ã‚“ãªç”»åƒã‚‚èª­ã¿å–ã‚Œã‚‹ã‚“ã ï¼ã¨è‡ªåˆ†ã‚‚é©šã„ãŸã®ã§ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯ç”»åƒã®èª­ã¿å–ã‚Šç²¾åº¦ã«ã¤ã„ã¦ã¯ç¢ºèªã—ã¾ã›ã‚“ã€‚ãªãŠã€æ¤œè¨¼ã«ã¯pythonã‚’ç”¨ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

## åŸºæœ¬çš„ãªä½¿ã„æ–¹
### ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã®å…¥åŠ›
:::details OpenAIã‚µã‚¤ãƒˆã‹ã‚‰ã‚³ãƒ”ãƒšã—ãŸå†…å®¹
```python
from openai import OpenAI
client = OpenAI()

response = client.chat.completions.create(
  model="gpt-4o-mini",
  messages=[
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "Who won the world series in 2020?"},
    {"role": "assistant", "content": "The Los Angeles Dodgers won the World Series in 2020."},
    {"role": "user", "content": "Where was it played?"}
  ]
)
```
:::
```python
{"role": "user", "content": "Who won the world series in 2020?"}
```
ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã®å…¥åŠ›ã®å ´åˆã¯ä¸Šã®ã‚ˆã†ã«roleã‚’è¨­å®šã—ã€contentã«stringã‚’æ¸¡ã™å½¢ã§messagesã®ãƒªã‚¹ãƒˆã‚’ä½œã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã—ãŸã­ã€‚ä»¥ä¸‹ã®OpenAIã®ã‚µã‚¤ãƒˆã«æ›¸ã„ã¦ã‚ã‚‹æƒ…å ±ãªã®ã§ã€è©³ã—ãã¯ãã¡ã‚‰ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
https://platform.openai.com/docs/guides/chat-completions

### ãƒ†ã‚­ã‚¹ãƒˆ+ç”»åƒã®å…¥åŠ›
ç”»åƒãŒ1æšã®å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚
:::details OpenAIã‚µã‚¤ãƒˆã‹ã‚‰ã‚³ãƒ”ãƒšã—ãŸå†…å®¹
```python
from openai import OpenAI

client = OpenAI()

response = client.chat.completions.create(
  model="gpt-4o-mini",
  messages=[
    {
      "role": "user",
      "content": [
        {"type": "text", "text": "Whatâ€™s in this image?"},
        {
          "type": "image_url",
          "image_url": {
            "url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg",
          },
        },
      ],
    }
  ],
  max_tokens=300,
)

print(response.choices[0])
```
:::
contentã®ä¸­ãŒstringå‹ã§ã¯ãªãè¾æ›¸å‹ã«ãªã£ã¦ã„ã¾ã™ã€‚typeã‚­ãƒ¼ã§textã‹image_urlã‚’æŒ‡å®šã—ã€image_urlã§ã¯ç”»åƒã®URLã‹base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸå€¤ã‚’å…¥åŠ›ã—ã¾ã™ã€‚
â†’å€‹äººçš„ã«ã¯contentã£ã¦stringå‹ã§ã‚‚ã„ã„ã—ã€è¾æ›¸å‹ã§ã‚‚ã„ã„ã£ã¦ã®ãŒæ°—æŒã¡æ‚ªã„ãªã¨æ€ã£ãŸã®ã§ã™ãŒã€å®Ÿéš›ã«openaiãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¾¿ã£ã¦ã¿ã‚‹ã¨ã€ç¢ºã‹ã«ã©ã¡ã‚‰ã§ã‚‚å‹çš„ã«ã¯å•é¡Œãªãã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã£ãŸã®ã¡ã€ã„ã„æ„Ÿã˜ã«å‡¦ç†ã•ã‚Œã¦ã‚‹ã£ã½ã„ã§ã™ã­ã€‚ç”»åƒãŒè¤‡æ•°ã«ãªã‚‹å ´åˆã‚‚"type": "image_url"ã‚’æŒã¤è¾æ›¸å‹ã‚’è¤‡æ•°ã«ã—ã¦ã‚ã’ã‚Œã°ã„ã„ã ã‘ãªã®ã§ç°¡å˜ã§ã™ã­ã€‚
â†“å‚è€ƒ
https://platform.openai.com/docs/guides/vision

ã¡ãªã¿ã«image_urlåŒæ§˜ã€ä»¥ä¸‹ã‚³ãƒ¼ãƒ‰ã®ã‚ˆã†ã«textã‚‚ãƒªã‚¹ãƒˆã«è¿½åŠ ã™ã‚‹ã“ã¨ã§1å›ã®è³ªå•ã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã§ã™ã€‚é€šå¸¸ã®contentã®stringå‹ã«å…¨ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚ã‚‹å ´åˆã¨ç²¾åº¦ã®éƒ¨åˆ†ãªã©ä½•ã‹å¤‰ã‚ã‚‹ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚â†’è©¦ã—ãŸæ„Ÿã˜é•ã„ã¯ã‚ã‹ã‚‰ãªã‹ã£ãŸã®ã§ã€è©³ã—ã„æ–¹ã„ãŸã‚‰æ•™ãˆã¦æ¬²ã—ã„ã§ã™ã€‚
```python
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": [
        {"type": "text", "text": "ä»Šæ—¥ã®æ˜¼é£Ÿã¯ã‚«ãƒ¬ãƒ¼ã§ã™"},
        {
            "type": "image_url",
            "image_url": {
                "url": f"data:image/png;base64,{base64_image}",
                "detail": selected_image_resolution_option
            }
        },
        {"type": "text", "text": "ä»Šæ—¥ã®å¤•é£Ÿã¯ãƒãƒ³ãƒãƒ¼ã‚°ã§ã™"},
    ]}
]
```
:::details å›ç­”
ä»Šæ—¥ã®æ˜¼é£Ÿã«ã‚«ãƒ¬ãƒ¼ã€ãã—ã¦å¤•é£Ÿã«ãƒãƒ³ãƒãƒ¼ã‚°ã§ã™ã‹ï¼ã©ã¡ã‚‰ã‚‚ç¾å‘³ã—ãã†ã§ã™ã­ã€‚ã‚«ãƒ¬ãƒ¼ã¯ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã§æ¸©ã‹ã„é£Ÿäº‹ã€ãƒãƒ³ãƒãƒ¼ã‚°ã¯ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ã§ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒã‚ã£ã¦æ¥½ã—ã¿ã§ã™ã­ã€‚ã©ã¡ã‚‰ãŒç‰¹ã«å¥½ãã§ã™ã‹ï¼Ÿ
:::

## ãƒˆãƒ¼ã‚¯ãƒ³èª¿æŸ»
### ãƒ†ã‚­ã‚¹ãƒˆã®ã¿
ã¾ãšã€ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã®å ´åˆã§ã‚‚contentã®ä¸­èº«ãŒstringå‹ã‹è¾æ›¸å‹ã‹ç•°ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ãã®é•ã„ã«ã‚ˆã£ã¦ãƒˆãƒ¼ã‚¯ãƒ³ãŒç•°ãªã‚‹ã‹ã‚’èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚
```python: stringå‹
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": "ä»Šæ—¥ã®æ˜¼é£Ÿã¯ã‚«ãƒ¬ãƒ¼ã§ã™"}
]
```
```python: è¾æ›¸å‹
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": [
        {"type": "text", "text": "ä»Šæ—¥ã®æ˜¼é£Ÿã¯ã‚«ãƒ¬ãƒ¼ã§ã™"}
    ]}
]
```
ä¸Šã®2ã¤ã§è©¦ã—ãŸã¨ã“ã‚å…¥åŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã©ã¡ã‚‰ã‚‚25ã§ã—ãŸã€‚ãªã®ã§ã€è¾æ›¸å‹ã®æ›¸ãæ–¹ã§ã‚ã‚ã†ã¨åŒã˜ãƒ†ã‚­ã‚¹ãƒˆã§ã‚ã‚Œã°å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã¯å¤‰ã‚ã‚‰ãªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

### ç”»åƒè¾¼ã¿ã®ãƒˆãƒ¼ã‚¯ãƒ³
ç”»åƒå…¥åŠ›ã«ã¯autoã€highã€lowã®ï¼“ç¨®é¡ã®ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯autoãŒé¸æŠã•ã‚Œç”»åƒã®è§£åƒåº¦ã«ã‚ˆã£ã¦ã€highã‹lowãŒè‡ªå‹•çš„ã«æ±ºã¾ã‚Šã¾ã™ã€‚æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã€ãã®å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«detailã‚’è¨­å®šã—ã¾ã™ã€‚
```python
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": [
        {"type": "text", "text": "ä½•ãŒæ˜ ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ"},
        {
            "type": "image_url",
            "image_url": {
                "url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg",
                "detail": "low"
            }
        },
    ]}
]
```
OpenAIã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã£ãŸç”»åƒURLã‚’ä½¿ç”¨ã—ã¦ã¿ã‚‹ã¨ã€autoãƒ¢ãƒ¼ãƒ‰ã§ã¯ç”»åƒã¯é«˜è§£åƒåº¦ã¨ã—ã¦highã§å‡¦ç†ã•ã‚ŒãŸã‚ˆã†ã§ã™ã€‚ä»¥ä¸‹ãŒhighã¨lowã®å ´åˆã®ãƒˆãƒ¼ã‚¯ãƒ³ã®é•ã„ã§ã™ã€‚
- auto(high)ã®å ´åˆï¼šprompt_tokens=36858
- lowã®å ´åˆï¼šprompt_tokens=2856

URLã§ã¯ãªãBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã€ãƒˆãƒ¼ã‚¯ãƒ³ã«é–¢ã—ã¦åŒæ§˜ã®æŒ™å‹•ã‚’ç¢ºèªã§ãã¾ã—ãŸã€‚
ãƒˆãƒ¼ã‚¯ãƒ³ã®è¨ˆç®—ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ãƒªãƒ³ã‚¯ã®æƒ…å ±ã‚’è¦‹ã‚‹ã«ãŠãã‚‰ãç”»åƒå†…ã«512Ã—512pxãŒã©ã‚Œãã‚‰ã„ã‚ã‚‹ã‹ã¨é«˜è§£åƒåº¦orä½è§£åƒåº¦ã§é‡‘é¡ãŒæ±ºã¾ã£ã¦ããã†ã§ã™ã€‚
https://platform.openai.com/docs/guides/vision/low-or-high-fidelity-image-understanding

ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã¯åˆ†ã‹ã‚Šã¾ã›ã‚“ãŒã€OpenAIã®Priceãƒšãƒ¼ã‚¸ã§ç”»åƒã®ã‚µã‚¤ã‚ºã‚’å…¥åŠ›ã™ã‚Œã°ãƒ¢ãƒ‡ãƒ«ã”ã¨ã®å‡¦ç†ã«ã‹ã‹ã‚‹é‡‘é¡ã‚’è¨ˆç®—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã™ã€‚â†’ã“ã®é‡‘é¡ã®éƒ¨åˆ†ã§ã‚‚å€¤ã‚’å¤‰ãˆã¦512pxãŒé‡‘é¡ãŒå¤‰ã‚ã‚‹å¢ƒç›®ãªã“ã¨ã‚’ç¢ºèªã§ãã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/457644e9c0c1-20240831.png)
https://openai.com/api/pricing/

## ç”»åƒã‚’å«ã‚“ã å±¥æ­´æ©Ÿèƒ½
ä»¥ä¸‹ã®ã‚ˆã†ã«ç”»åƒæƒ…å ±ã‚’é€ã‚Œã°ã€éå»ã®ç”»åƒã®æƒ…å ±ã«ã¤ã„ã¦ã‚‚ç†è§£ã—ã¦ã€ã©ã®ã‚ˆã†ãªç”»åƒã‹ã‚’å›ç­”ã—ã¦ãã‚Œã¾ã—ãŸã€‚
```python
messages = [
    {"role": "system", "content": "You are a helpful assistant."},
    {"role": "user", "content": [
        {"type": "text", "text": "ã“ã‚“ã«ã¡ã¯"},
        {
            "type": "image_url",
            "image_url": {
                "url": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg",
                "detail": "low"
            }
        },
    ]},
    {"role": "assistant", "content": "ã¯ã„ã€ã“ã‚“ã«ã¡ã¯"},
    {"role": "user", "content": "å…ˆã»ã©ã®ç”»åƒã«ã¯ä½•ãŒæ˜ ã£ã¦ã„ã¾ã™ã‹"},
]
```
ã“ã®è¾ºã‚Šã¯ãƒ†ã‚­ã‚¹ãƒˆã®ã¿ã®ãƒãƒ£ãƒƒãƒˆã¨åŒæ§˜ã«éå»ã®æƒ…å ±ã‚‚ä¸€ç·’ã«é€ã£ã¦ã‚„ã‚Œã°ã€ãã‚Œã‚’è¸ã¾ãˆãŸå›ç­”ã¯ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã§ã™ã­ã€‚

## ã¾ã¨ã‚
GPTç³»ã®ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã¯messagesã®contentã®ã¨ã“ã‚ã«è¾æ›¸å‹ã§ç”»åƒã®æƒ…å ±ã‚‚æ¸¡ã™ã‚ˆã†ã«ã™ã‚‹ãã‚‰ã„ã§ã€ç°¡å˜ã«åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚æ„å¤–ã¨ä»Šå›èª¿ã¹ãŸã‚ˆã†ãªå†…å®¹ã‚’è¨˜äº‹ã«ã—ã¦ã„ã‚‹äººã¯å°‘ãªã„ã‚ˆã†ã«æ€ãˆãŸã®ã§ã€GPTç³»ã®ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä½¿ã†äººã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚

## ä½™è«‡
æ¤œè¨¼ã¯ä»¥ä¸‹2ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã©ã§ã¡ã‚‡ã“ã¡ã‚‡ã“å¤‰ãˆãªãŒã‚‰è¡Œã„ã¾ã—ãŸã€‚streamlitã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚pythonç’°å¢ƒã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€envã‚’è¨­å®šã™ã‚Œã°ã€ä»–ã®äººã§ã‚‚ç°¡å˜ã«è©¦ã›ã‚‹ã¨æ€ã†ã®ã§ä¸€å¿œå…±æœ‰ã§ã™ã€‚
:::details app.py
```python
import streamlit as st
import base64
from openai_api import gpt_response

# ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨OCRæ©Ÿèƒ½
def encode_image(image):
    return base64.b64encode(image.read()).decode("utf-8")

st.title("ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ†ã‚¹ãƒˆ")

## ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å®šç¾©
model_options = ['gpt-4o-mini']
image_resolution_options = ['auto', 'high', 'low']

## ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ä½œæˆ
selected_model_option = st.sidebar.selectbox('ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„:', model_options)
selected_image_resolution_option = st.sidebar.selectbox('ç”»åƒã®å‡¦ç†è§£åƒåº¦:', image_resolution_options)

# ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
user_input = st.text_input("è³ªå•å…¥åŠ›æ¬„", "")
uploaded_file = st.file_uploader("ç”»åƒ", type=("png", "jpg", "jpeg"))

if uploaded_file is not None:
    base64_image = encode_image(uploaded_file)

if st.button("é€ä¿¡"):
    if user_input:
        if uploaded_file is not None:
            messages = [
                {"role": "system", "content": "You are a helpful assistant."},
                {"role": "user", "content": [
                    {"type": "text", "text": user_input},
                    {
                        "type": "image_url",
                        "image_url": {
                            "url": f"data:image/png;base64,{base64_image}",
                            "detail": selected_image_resolution_option
                        }
                    },
                ]}
            ]
        else:
            messages = [
                {"role": "system", "content": "You are a helpful assistant."},
                {"role": "user", "content": user_input},
            ]
        with st.spinner('å›ç­”ç”Ÿæˆä¸­...'):
            response = gpt_response(messages, selected_model_option)
        st.write("## å›ç­”ã®ã¿")
        st.write(response.choices[0].message.content)
        st.write("## ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®messages")
        st.write(messages)
        st.write("## ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãã®ã¾ã¾")
        st.write(response)

```
:::

:::details openai_api.py
```python
import os

from openai import OpenAI
from openai.types.chat import ChatCompletion
from dotenv import load_dotenv

load_dotenv(override=True)

# APIã‚­ãƒ¼ã‚’è¨­å®š
api_key = os.environ["OPENAI_API_KEY"]

client = OpenAI(api_key=api_key)
def gpt_response(messages: list[dict], model: str) -> ChatCompletion:
    response = client.chat.completions.create(
        model=model,
        messages=messages
    )
    return response
```
:::
ã“ã‚“ãªæ„Ÿã˜ã§è³ªå•å…¥ã‚Œã¦ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€é€ä¿¡ã§ãã‚‹æ„Ÿã˜ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/9523d237ac44-20240831.png)
![](https://storage.googleapis.com/zenn-user-upload/34621b5581cc-20240831.png)

